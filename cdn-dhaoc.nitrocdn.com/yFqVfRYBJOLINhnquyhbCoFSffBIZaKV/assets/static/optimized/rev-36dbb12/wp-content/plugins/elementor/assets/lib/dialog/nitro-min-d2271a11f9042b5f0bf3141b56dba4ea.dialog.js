(function(W,t){"use strict";var x={widgetsTypes:{},createWidgetType:function(t,e,i){if(!i){i=this.Widget}var n=function(){i.apply(this,arguments)};var o=n.prototype=new i(t);o.types=o.types.concat([t]);W.extend(o,e);o.constructor=n;n.extend=function(t,e){return x.createWidgetType(t,e,n)};return n},addWidgetType:function(t,e,i){if(e&&e.prototype instanceof this.Widget){return this.widgetsTypes[t]=e}return this.widgetsTypes[t]=this.createWidgetType(t,e,i)},getWidgetType:function(t){return this.widgetsTypes[t]}};x.Instance=function(){var o=this,t={},i={};var e=function(){t.body=W("body")};var n=function(t){var e={classPrefix:"dialog",effects:{show:"fadeIn",hide:"fadeOut"}};W.extend(i,e,t)};this.createWidget=function(t,e){var i=x.getWidgetType(t),n=new i(t);e=e||{};n.init(o,e);return n};this.getSettings=function(t){if(t){return i[t]}return Object.create(i)};this.init=function(t){n(t);e();return o};o.init()};x.Widget=function(n){var o=this,s={},r={},a={},t=0,e=["refreshPosition"];var i=function(){var t=[a.window];if(a.iframe){t.push(jQuery(a.iframe[0].contentWindow))}t.forEach(function(t){if(s.hide.onEscKeyPress){t.on("keyup",w)}if(s.hide.onOutsideClick){t[0].addEventListener("click",g,true)}if(s.hide.onOutsideContextMenu){t[0].addEventListener("contextmenu",g,true)}if(s.position.autoRefresh){t.on("resize",o.refreshPosition)}});if(s.hide.onClick||s.hide.onBackgroundClick){a.widget.on("click",d)}};var u=function(t,e){var i=s.effects[t],n=a.widget;if(W.isFunction(i)){i.apply(n,e)}else{if(n[i]){n[i].apply(n,e)}else{throw"Reference Error: The effect "+i+" not found"}}};var c=function(){var t=e.concat(o.getClosureMethods());W.each(t,function(){var t=this,e=o[t];o[t]=function(){e.apply(o,arguments)}})};var f=function(t){if(!t.my){return}var e=/left|right/,n=/([+-]\d+)?$/,o=a.iframe.offset(),s=a.iframe[0].contentWindow,i=t.my.split(" "),r=[];if(i.length===1){if(e.test(i[0])){i.push("center")}else{i.unshift("center")}}i.forEach(function(t,e){var i=t.replace(n,function(t){t=+t||0;if(!e){t+=o.left-s.scrollX}else{t+=o.top-s.scrollY}if(t>=0){t="+"+t}return t});r.push(i)});t.my=r.join(" ")};var d=function(t){if(v(t)){return}if(s.hide.onClick){if(W(t.target).closest(s.selectors.preventClose).length){return}}else if(t.target!==this){return}o.hide()};var l=function(t){if(!s.hide.ignore){return false}return!!W(t.target).closest(s.hide.ignore).length};var g=function(t){if(v(t)||W(t.target).closest(a.widget).length||l(t)){return}o.hide()};var h=function(){o.addElement("widget");o.addElement("header");o.addElement("message");o.addElement("window",window);o.addElement("body",document.body);o.addElement("container",s.container);if(s.iframe){o.addElement("iframe",s.iframe)}if(s.closeButton){if(s.closeButtonClass){s.closeButtonOptions.iconClass=s.closeButtonClass}const i=W("<div>",s.closeButtonOptions.attributes),n=W(s.closeButtonOptions.iconElement).addClass(s.closeButtonOptions.iconClass);i.append(n);o.addElement("closeButton",i)}var t=o.getSettings("id");if(t){o.setID(t)}var e=[];W.each(o.types,function(){e.push(s.classes.globalPrefix+"-type-"+this)});e.push(o.getSettings("className"));a.widget.addClass(e.join(" "))};var p=function(t,e){var i=W.extend(true,{},t.getSettings());s={headerMessage:"",message:"",effects:i.effects,classes:{globalPrefix:i.classPrefix,prefix:i.classPrefix+"-"+n,preventScroll:i.classPrefix+"-prevent-scroll"},selectors:{preventClose:"."+i.classPrefix+"-prevent-close"},container:"body",preventScroll:false,iframe:null,closeButton:false,closeButtonOptions:{iconClass:i.classPrefix+"-close-button-icon",attributes:{},iconElement:"<i>"},position:{element:"widget",my:"center",at:"center",enable:true,autoRefresh:false},hide:{auto:false,autoDelay:5e3,onClick:false,onOutsideClick:true,onOutsideContextMenu:false,onBackgroundClick:true,onEscKeyPress:true,ignore:""}};W.extend(true,s,o.getDefaultSettings(),e);y()};var y=function(){W.each(s,function(t){var e=t.match(/^on([A-Z].*)/);if(!e){return}e=e[1].charAt(0).toLowerCase()+e[1].slice(1);o.on(e,this)})};var v=function(t){return t.type==="click"&&t.button===2};var m=function(t){return t.replace(/([a-z])([A-Z])/g,function(){return arguments[1]+"-"+arguments[2].toLowerCase()})};var w=function(t){var e=27,i=t.which;if(e===i){o.hide()}};var b=function(){var t=[a.window];if(a.iframe){t.push(jQuery(a.iframe[0].contentWindow))}t.forEach(function(t){if(s.hide.onEscKeyPress){t.off("keyup",w)}if(s.hide.onOutsideClick){t[0].removeEventListener("click",g,true)}if(s.hide.onOutsideContextMenu){t[0].removeEventListener("contextmenu",g,true)}if(s.position.autoRefresh){t.off("resize",o.refreshPosition)}});if(s.hide.onClick||s.hide.onBackgroundClick){a.widget.off("click",d)}};this.addElement=function(t,e,i){var n=a[t]=W(e||"<div>"),o=m(t);i=i?i+" ":"";i+=s.classes.globalPrefix+"-"+o;i+=" "+s.classes.prefix+"-"+o;n.addClass(i);return n};this.destroy=function(){b();a.widget.remove();o.trigger("destroy");return o};this.getElements=function(t){return t?a[t]:a};this.getSettings=function(t){var e=Object.create(s);if(t){return e[t]}return e};this.hide=function(){if(!o.isVisible()){return}clearTimeout(t);u("hide",arguments);b();if(s.preventScroll){o.getElements("body").removeClass(s.classes.preventScroll)}o.trigger("hide");return o};this.init=function(t,e){if(!(t instanceof x.Instance)){throw"The "+o.widgetName+" must to be initialized from an instance of DialogsManager.Instance"}c();o.trigger("init",e);p(t,e);h();o.buildWidget();o.attachEvents();o.trigger("ready");return o};this.isVisible=function(){return a.widget.is(":visible")};this.on=function(t,e){if("object"===typeof t){W.each(t,function(t){o.on(t,this)});return o}var i=t.split(" ");i.forEach(function(t){if(!r[t]){r[t]=[]}r[t].push(e)});return o};this.off=function(t,e){if(!r[t]){return o}if(!e){delete r[t];return o}var i=r[t].indexOf(e);if(-1!==i){r[t].splice(i,1)}return o};this.refreshPosition=function(){if(!s.position.enable){return}var t=W.extend({},s.position);if(a[t.of]){t.of=a[t.of]}if(!t.of){t.of=window}if(s.iframe){f(t)}a[t.element].position(t)};this.setID=function(t){a.widget.attr("id",t);return o};this.setHeaderMessage=function(t){o.getElements("header").html(t);return o};this.setMessage=function(t){a.message.html(t);return o};this.setSettings=function(t,e){if(jQuery.isPlainObject(e)){W.extend(true,s[t],e)}else{s[t]=e}return o};this.show=function(){clearTimeout(t);a.widget.appendTo(a.container).hide();u("show",arguments);o.refreshPosition();if(s.hide.auto){t=setTimeout(o.hide,s.hide.autoDelay)}i();if(s.preventScroll){o.getElements("body").addClass(s.classes.preventScroll)}o.trigger("show");return o};this.trigger=function(t,i){var e="on"+t[0].toUpperCase()+t.slice(1);if(o[e]){o[e](i)}var n=r[t];if(!n){return}W.each(n,function(t,e){e.call(o,i)});return o}};x.Widget.prototype.types=[];x.Widget.prototype.buildWidget=function(){var t=this.getElements(),e=this.getSettings();t.widget.append(t.header,t.message);this.setHeaderMessage(e.headerMessage);this.setMessage(e.message);if(this.getSettings("closeButton")){t.widget.prepend(t.closeButton)}};x.Widget.prototype.attachEvents=function(){var t=this;if(t.getSettings("closeButton")){t.getElements("closeButton").on("click",function(){t.hide()})}};x.Widget.prototype.getDefaultSettings=function(){return{}};x.Widget.prototype.getClosureMethods=function(){return[]};x.Widget.prototype.onHide=function(){};x.Widget.prototype.onShow=function(){};x.Widget.prototype.onInit=function(){};x.Widget.prototype.onReady=function(){};x.widgetsTypes.simple=x.Widget;x.addWidgetType("buttons",{activeKeyUp:function(t){var e=9;if(t.which===e){t.preventDefault()}if(this.hotKeys[t.which]){this.hotKeys[t.which](this)}},activeKeyDown:function(t){if(!this.focusedButton){return}var e=9;if(t.which===e){t.preventDefault();var i=this.focusedButton.index(),n;if(t.shiftKey){n=i-1;if(n<0){n=this.buttons.length-1}}else{n=i+1;if(n>=this.buttons.length){n=0}}this.focusedButton=this.buttons[n].focus()}},addButton:function(t){var e=this,i=e.getSettings(),n=jQuery.extend(i.button,t);var o=t.classes?t.classes+" ":"";o+=i.classes.globalPrefix+"-button";var s=e.addElement(t.name,W("<"+n.tag+">").html(t.text),o);e.buttons.push(s);var r=function(){if(i.hide.onButtonClick){e.hide()}if(W.isFunction(t.callback)){t.callback.call(this,e)}};s.on("click",r);if(t.hotKey){this.hotKeys[t.hotKey]=r}this.getElements("buttonsWrapper").append(s);if(t.focus){this.focusedButton=s}return e},bindHotKeys:function(){this.getElements("window").on({keyup:this.activeKeyUp,keydown:this.activeKeyDown})},buildWidget:function(){x.Widget.prototype.buildWidget.apply(this,arguments);var t=this.addElement("buttonsWrapper");this.getElements("widget").append(t)},getClosureMethods:function(){return["activeKeyUp","activeKeyDown"]},getDefaultSettings:function(){return{hide:{onButtonClick:true},button:{tag:"button"}}},onHide:function(){this.unbindHotKeys()},onInit:function(){this.buttons=[];this.hotKeys={};this.focusedButton=null},onShow:function(){this.bindHotKeys();if(!this.focusedButton){this.focusedButton=this.buttons[0]}if(this.focusedButton){this.focusedButton.focus()}},unbindHotKeys:function(){this.getElements("window").off({keyup:this.activeKeyUp,keydown:this.activeKeyDown})}});x.addWidgetType("lightbox",x.getWidgetType("buttons").extend("lightbox",{getDefaultSettings:function(){var t=x.getWidgetType("buttons").prototype.getDefaultSettings.apply(this,arguments);return W.extend(true,t,{contentWidth:"auto",contentHeight:"auto",position:{element:"widgetContent",of:"widget",autoRefresh:true}})},buildWidget:function(){x.getWidgetType("buttons").prototype.buildWidget.apply(this,arguments);var t=this.addElement("widgetContent"),e=this.getElements();t.append(e.header,e.message,e.buttonsWrapper);e.widget.html(t);if(e.closeButton){t.prepend(e.closeButton)}},onReady:function(){var t=this.getElements(),e=this.getSettings();if("auto"!==e.contentWidth){t.message.width(e.contentWidth)}if("auto"!==e.contentHeight){t.message.height(e.contentHeight)}}}));x.addWidgetType("confirm",x.getWidgetType("lightbox").extend("confirm",{onReady:function(){x.getWidgetType("lightbox").prototype.onReady.apply(this,arguments);var t=this.getSettings("strings"),e=this.getSettings("defaultOption")==="cancel";this.addButton({name:"cancel",text:t.cancel,callback:function(t){t.trigger("cancel")},focus:e});this.addButton({name:"ok",text:t.confirm,callback:function(t){t.trigger("confirm")},focus:!e})},getDefaultSettings:function(){var t=x.getWidgetType("lightbox").prototype.getDefaultSettings.apply(this,arguments);t.strings={confirm:"OK",cancel:"Cancel"};t.defaultOption="cancel";return t}}));x.addWidgetType("alert",x.getWidgetType("lightbox").extend("alert",{onReady:function(){x.getWidgetType("lightbox").prototype.onReady.apply(this,arguments);var t=this.getSettings("strings");this.addButton({name:"ok",text:t.confirm,callback:function(t){t.trigger("confirm")}})},getDefaultSettings:function(){var t=x.getWidgetType("lightbox").prototype.getDefaultSettings.apply(this,arguments);t.strings={confirm:"OK"};return t}}));t.DialogsManager=x})(typeof jQuery!=="undefined"?jQuery:typeof require==="function"&&require("jquery"),typeof module!=="undefined"&&typeof module.exports!=="undefined"?module.exports:window);